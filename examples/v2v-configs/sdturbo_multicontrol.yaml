# StreamDiffusion SD-Turbo Multi-ControlNet Configuration  
# Demonstrates: Fast inference with multiple ControlNet guidance (no IPAdapter for speed)

# Base model configuration
model_id: "stabilityai/sd-turbo"

# StreamDiffusion core parameters  
t_index_list: [27, 32]       # SD-Turbo optimized timesteps
width: 512
height: 512
device: "cuda"
dtype: "float16"

# Generation parameters
prompt: "masterpiece, high quality, detailed anime character"
negative_prompt: "blurry, low quality, distorted, 3d render"
guidance_scale: 1.0         # SD-Turbo typically uses lower guidance
num_inference_steps: 50      # SD-Turbo optimized for few steps
seed: 789

# Temporal consistency and optimization
frame_buffer_size: 1
delta: 0.7
use_denoising_batch: true
use_lcm_lora: true          # SD-Turbo benefits from LCM LoRA
use_tiny_vae: true
acceleration: "tensorrt"    # "xformers" for non-TensorRT setups
cfg_type: "self"

# Engine directory for TensorRT
engine_dir: "./engines/sdturbo/"

# Enable ControlNet (no IPAdapter for maximum speed)
use_controlnet: true
use_cached_attn: true
cache_maxframes: 2
cache_interval: 1

# ControlNet configurations
controlnets:
  # Canny edge detection for structural guidance
  # - model_id: "thibaud/controlnet-sd21-canny-diffusers"
  #   conditioning_scale: 0.8
  #   conditioning_channels: 3
  #   preprocessor: "canny"
  #   preprocessor_params:
  #     low_threshold: 100
  #     high_threshold: 200
  #   enabled: true

  # Soft edge detection for artistic guidance
  # - model_id: "thibaud/controlnet-sd21-hed-diffusers" 
  #   conditioning_scale: 0.3
  #   preprocessor: "soft_edge"
  #   preprocessor_params:
  #     image_resolution: 512
  #     strength: 1.0
  #     soft_threshold: 0.5
  #     multi_scale: true
  #     gaussian_sigma: 1.0
  #   enabled: true

  # - model_id: "daydreamlive/TemporalNet2-stable-diffusion-2-1"
  #   conditioning_scale: 1.0
  #   conditioning_channels: 6
  #   preprocessor: "temporal_net_tensorrt"
  #   preprocessor_params:
  #     image_resolution: 512
  #     flow_strength: 1.0
  #     control_format: "flow_visualization"
  #     engine_path: "/home/user/StreamDiffusion/models/temporal_net/raft_small_min_512x512_max_1024x1024.engine"
  #   enabled: true
  - model_id: thibaud/controlnet-sd21-depth-diffusers
    conditioning_scale: 1.0
    conditioning_channels: 3
    preprocessor: depth
    preprocessor_params: {}
    enabled: true
  - model_id: thibaud/controlnet-sd21-openpose-diffusers
    conditioning_scale: 0.711
    conditioning_channels: 3
    preprocessor: openpose
    preprocessor_params: {}
    enabled: true